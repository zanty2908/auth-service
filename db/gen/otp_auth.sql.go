// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.23.0
// source: otp_auth.sql

package db

import (
	"context"
	"time"
)

const createOTPAuth = `-- name: CreateOTPAuth :one
INSERT INTO otp_authentications(phone, otp, resend_at, expires_at, created_at)
VALUES($1, $2, $3, $4, $5)
RETURNING id, phone, otp, resend_at, expires_at, created_at, deleted_at
`

type CreateOTPAuthParams struct {
	Phone     string    `json:"phone"`
	Otp       string    `json:"otp"`
	ResendAt  time.Time `json:"resendAt"`
	ExpiresAt time.Time `json:"expiresAt"`
	CreatedAt time.Time `json:"createdAt"`
}

func (q *Queries) CreateOTPAuth(ctx context.Context, arg *CreateOTPAuthParams) (*OtpAuthentication, error) {
	row := q.db.QueryRow(ctx, createOTPAuth,
		arg.Phone,
		arg.Otp,
		arg.ResendAt,
		arg.ExpiresAt,
		arg.CreatedAt,
	)
	var i OtpAuthentication
	err := row.Scan(
		&i.ID,
		&i.Phone,
		&i.Otp,
		&i.ResendAt,
		&i.ExpiresAt,
		&i.CreatedAt,
		&i.DeletedAt,
	)
	return &i, err
}

const deleteOTPAuthByID = `-- name: DeleteOTPAuthByID :exec
UPDATE otp_authentications 
SET deleted_at = now()
WHERE id = $1
`

func (q *Queries) DeleteOTPAuthByID(ctx context.Context, id int32) error {
	_, err := q.db.Exec(ctx, deleteOTPAuthByID, id)
	return err
}

const deleteOTPAuthByPhone = `-- name: DeleteOTPAuthByPhone :exec
UPDATE otp_authentications
SET deleted_at = now()
WHERE phone = $1 AND expires_at > $2 AND deleted_at is null
`

type DeleteOTPAuthByPhoneParams struct {
	Phone     string    `json:"phone"`
	ExpiresAt time.Time `json:"expiresAt"`
}

func (q *Queries) DeleteOTPAuthByPhone(ctx context.Context, arg *DeleteOTPAuthByPhoneParams) error {
	_, err := q.db.Exec(ctx, deleteOTPAuthByPhone, arg.Phone, arg.ExpiresAt)
	return err
}

const getOTPAuth = `-- name: GetOTPAuth :one
SELECT id, phone, otp, resend_at, expires_at, created_at, deleted_at 
FROM otp_authentications 
WHERE phone = $1 AND expires_at > $2 AND deleted_at is null
ORDER BY created_at DESC
LIMIT 1
`

type GetOTPAuthParams struct {
	Phone     string    `json:"phone"`
	ExpiresAt time.Time `json:"expiresAt"`
}

func (q *Queries) GetOTPAuth(ctx context.Context, arg *GetOTPAuthParams) (*OtpAuthentication, error) {
	row := q.db.QueryRow(ctx, getOTPAuth, arg.Phone, arg.ExpiresAt)
	var i OtpAuthentication
	err := row.Scan(
		&i.ID,
		&i.Phone,
		&i.Otp,
		&i.ResendAt,
		&i.ExpiresAt,
		&i.CreatedAt,
		&i.DeletedAt,
	)
	return &i, err
}

const hasOTPAuthValid = `-- name: HasOTPAuthValid :one
SELECT 1
FROM otp_authentications 
WHERE phone = $1 AND expires_at > $2 AND deleted_at is null
ORDER BY created_at DESC
`

type HasOTPAuthValidParams struct {
	Phone     string    `json:"phone"`
	ExpiresAt time.Time `json:"expiresAt"`
}

func (q *Queries) HasOTPAuthValid(ctx context.Context, arg *HasOTPAuthValidParams) (int32, error) {
	row := q.db.QueryRow(ctx, hasOTPAuthValid, arg.Phone, arg.ExpiresAt)
	var column_1 int32
	err := row.Scan(&column_1)
	return column_1, err
}
